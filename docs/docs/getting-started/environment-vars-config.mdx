---
sidebar_position: 4
---
import CodeBlock from '@theme/CodeBlock';
import Env from '!!raw-loader!../../../env.js';
import AppConfig from '!!raw-loader!../../../app.config.ts';
import EnvClient from '!!raw-loader!../../../src/core/env.js';





# Environment variables

Managing environment variables in your project is an essential task, but it can also be challenging. That's why we have included a complete setup for environment variables in this project. This setup comes with validation and type-checking using the `zod` library.

All the code related to environment variables is located in the `env.js` and `src/core/env.js` files. The `env.js` read the `APP_ENV` variable and loads the correct `.env` file, then defines the `zod` schema for the environment variables for client and build-time, parses the `_env` object, and returns the parsed object, or throws errors in case of invalid or missing variables.

To increase security, we are splitting environment variables into two parts:

* **Client Variables**: Variables that are safe to be exposed to the client and used in your `src` folder. These variables are passed to the client side using the `extra` configuration in the `app.config.ts` file.
* **Build Time Variables**: Variables that we don't need on the client-side and are only used in the `app.config.ts`, for example `SENTRY_AUTH` to upload the source maps to Sentry.

By using this pre-configured setup for environment variables, you can focus on building your project without worrying about managing and validating your environment variables.

This setup is highly inspired by [T3 Stack](https://create.t3.gg/) üëå

## Adding a new environment variable to the project.

To add a new environment variable to the project, follow these steps:


1. Add the new environment variable to the correct `zod` schema inside the `env.js` file based on this simple rule :
If the variable is used in the `src` folder, add it to the `client` schema, otherwise add it to the `buildTime` schema.

This will ensure that the new variable is validated correctly. and make sure we are only sending the correct vars to the client side
Here's an example:

```js title="env.js"
const client = z.object({
  // ...
  // add the new environment variable here/ accessible on the client side and build time(app.config.ts)
  NEW_ENV_VAR: z.string(),
});

const buildTime = z.object({
  // ...
  // add the new environment variable here / accessible only on build time(app.config.ts)
  NEW_SECRET_ENV: z.string(),
});
```
2. Add the new environment variable to the correct env object inside the `env.js`, `_clientEnv` for client variables and `_buildTimeEnv` for build time variables. Here's an example:

```js title="env.js"
const _clientEnv = {
  // ...
  // add the new environment variable here
  NEW_ENV_VAR: process.env.NEW_ENV_VAR,
};

const _buildTimeEnv = {
  // ...
  // add the new environment variable here
  NEW_SECRET_ENV: process.env.NEW_SECRET_ENV,
};
```

3. Add the new environment variable to your `.env` files. Make sure to include it in all relevant files (`development`, `staging`, and `production`). Here's an example:

```env title=".env.{APP_ENV}"
# ...
# add the new environment variable here
NEW_ENV_VAR=my-new-var
```

4. The new environment variable is now ready to use in your project. You can access it in your code using the `Env` object, like this:

```ts title="client.ts"
import { Env } from '@env';
import axios from 'axios';
export const client = axios.create({
  baseURL: Env.API_URL,
});

```
:::info
using `import { Env } from '@env';` will import the env from the `src/core/env.js` file, which export client only env vars.
:::

5. Use `APP_ENV` to load the correct `.env` file :

```bash
APP_ENV=production yarn start -cc
```

As mentioned earlier, `zod` is used to validate environment variables at runtime and build time. If there are any missing or invalid variables, you'll see an error message with information on what needs to be fixed. Here's an example error message:
```bash
‚ùå Invalid environment variables: { TEST: [ 'Required' ] }
‚ùå Missing variables in .env.development file, Make sure all required variables are defined in the .env.development file.
üí° Tip: If you recently updated the .env.development file and the error still persists, try restarting the server with the -cc flag to clear the cache.
```

## How it works

#### ‚úÖ Validate and parse environment variables

If you take a look at the `env.js` file, you will notice that the file is split into tree main parts as shown below:


<CodeBlock className="language-js"
  title="env.js"
  highlightLines={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]}
  metastring="title=env.js">
  {Env}
</CodeBlock>

**In the first part**   We load the correct `.env` file based on the `APP_ENV` variable using `dotenv` package. If the `APP_ENV` variable is not defined, we default to `development`.

we define some static variables for the app such as the app name, bundle id and package. While these variables can be added to the `.env` files, we recommend keeping them in the `env.js` file as they are not meant to change. To handle different app variants, you can add suffixes to these variables using the `withEnvSuffix` function.

**In the second part**, we define the `zod` schema for the environment variables.

We split the environment variables into two parts:

* **Client Variables**: Variables that are safe to be exposed to the client and used in the `src` folder.

* **Build Time Variables**: Variables that we don't need on the client-side and are only used in the `app.config.ts`, for example `SENTRY_AUTH` to upload the source maps to Sentry.

These schemas are used to validate the environment variables. All the environment variables should be added to the correct schema.

We use the `z.infer` utility to infer the environment variables' types from the schema and use it to define the `_clientEnv` and `_buildTimeEnv` objects' type. This means that if you add a new environment variable to the schema, you will get a type error if you don't add it to the correct `_clientEnv` and `_buildTimeEnv` object as well, and vice versa.

**Finally**, in the third part, we merge variables to `_env`, pare it using the zod schema, and return the parsed object as well as the client environment variable, or throw errors in case of invalid or missing variables.


#### ‚úÖ Use and send environment variables to the client

Now its easy as importing `Env` , `ClientEnv`  and `withEnvSuffix` from the `./env.js` file and use inside our `app.config.ts`, and finally send client env vars to the client side using `extra` property.

<CodeBlock className="language-ts"
  title="app.config.ts"
  highlightLines={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]}
  metastring="title=app.config.ts">
  {AppConfig}
</CodeBlock>


#### ‚úÖ Type checking for client environment variables

Here, we added a separate file to export all variables that have already been passed in the `extra` property to the client side. We added a little bit of magic to make it type-safe and easy to use.

<CodeBlock className="language-ts"
  title="src/core/env.js"
  highlightLines={[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]}
  metastring="title=src/core/env.js">
  {EnvClient}
</CodeBlock>

Now the environment variables are ready to use in your project. You can access them in your code by importing `Env` from `@env` and using it like this:

```ts title="client.ts"
import { Env } from '@env';
import axios from 'axios';
export const client = axios.create({
  baseURL: Env.API_URL,
});
```



<details>
   <summary> Under 2.1.0 setup </summary>

We opted to use a simple typescript file to store all the environment variables and configuration for a simple reason, adding typechecking for the environment variables to make sure we are not missing any required variables using the correct type for each variable.

Using a simple typescript file for environment variables help us keep the project simple as possible as we didn't need to add any extra dependencies to the project.

## Adding environment variables

The environment variables file is located at `src/config` and it's support multiple app variant such as `development`, `staging` and `production`.

```ts title="src/config/config.ts"
const packageJSON = require('../package.json');

// default values
const SCHEME = 'com.obytes';
const APP_NAME = 'ObytesApp';

const development = {
  APP_ENV: 'development',
  name: APP_NAME,
  scheme: `${SCHEME}.development`,
  icon: './assets/icon.development.png',
  foregroundImage: './assets/icon.development.png',
  API_URL: 'https://dummyjson.com/',
  version: packageJSON.version,
};

const staging = {
  APP_ENV: 'staging',
  name: APP_NAME,
  scheme: `${SCHEME}.staging`,
  icon: './assets/icon.staging.png',
  foregroundImage: './assets/icon.staging.png',
  API_URL: 'https://dummyjson.com/',
  version: packageJSON.version,
};
const production = {
  APP_ENV: 'production',
  name: APP_NAME,
  scheme: `${SCHEME}`,
  icon: './assets/icon.png',
  foregroundImage: './assets/icon.png',
  API_URL: 'https://dummyjson.com/',
  version: packageJSON.version,
};

const configs = { development, staging, production };

function getConfig(appEnv) {
  return configs[appEnv];
}

module.exports = { getConfig };
```

```ts title="src/config/index.ts"
// we only use this file to add typescript support to the config file
// unfortunately, we cant import  typescript config inside expo config file
import Constants from 'expo-constants';

import { getConfig } from './config.js';

const NConfig = getConfig(
  Constants.expoConfig?.extra?.APP_ENV ?? 'development'
);

type APP_ENV_Type = 'development' | 'staging' | 'production';
export type ConfigType = {
  scheme: string;
  icon: string;
  foregroundImage: string;
  APP_ENV: APP_ENV_Type;
  API_URL: string;
  version: string;
  name: string;
};
const Config = NConfig as ConfigType;

export default Config;
```

:::note
We need only the ts file configuration file but as we can't import typescript files in expo config file. we need to create a js file that will export the same configuration as the ts file.
:::

## Using environment variables

As we are using an absolute import for the configuration file, you can easily import environment variables in any file in the project.

```ts title="src/api/common/client.tsx"
import Config from '@config';
import axios from 'axios';
export const client = axios.create({
  baseURL: Config.API_URL,
});
```

</details>
